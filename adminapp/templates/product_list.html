{% extends "base.html" %}
{% load static %}

{% block title %}
Products Administration ‚Äî Bean & Bites
{% endblock %}

{% block topbar %}
<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <img src="https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=7b0e8aa6361fd4d641b2f2d7a1efc0c3" alt="logo" />
      <h1>Admin ‚Äî Bean & Bites</h1>
    </div>

    <!-- User menu, handled by main.js -->
    <div class="user-panel">
      {% if request.user.is_authenticated %}
      <div id="userMenu" class="user-menu">
        <button id="userMenuBtn" class="btn menu-btn">‚ò∞</button>
        <div class="menu-dropdown hidden" id="menuDropdown">
          <a href="#" id="profileLink">üë§ {{ request.user.username }}</a>
          <a href="{% url 'adminlanding' %}">‚öôÔ∏è Administration</a>
          <a href="{% url 'logout' %}" class="logout">üö™ Logout</a>
        </div>
      </div>
      {% else %}
      <button id="loginButton" class="btn primary">Login</button>
      {% endif %}
    </div>

  </div>
</header>
{% endblock %}

{% block canvas %}

<!-- Local admin header -->
<div class="admin-local-header container">
  <a href="{% url 'adminlanding' %}" class="btn">‚¨Ö Back to Admin Panel</a>
</div>

<main class="container admin-dashboard">

  <div style="display:flex;justify-content:space-between;align-items:center; margin-bottom:20px;">
    <h2>Products Administration</h2>
    <a href="{% url 'product_add' %}" class="btn primary">‚ûï Add New Product</a>
    <a href="{% url 'category_list' %}" class="btn primary">‚ûï Administrar categorias</a>
    <a href="{% url 'rubro_list' %}" class="btn primary">‚ûï Administrar rubros</a>
  </div>

  <p class="muted">Manage your products. Click edit to modify or delete to remove.</p>

  <table class="users-table" style="margin-top:20px;">
    <thead>
      <tr>
        <th>Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Discount</th>
        <th>Featured</th>
        <th>Stock</th>
        <th>Bundle?</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for product in products %}
      <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.category.name }}</td>
        <td>${{ product.price }}</td>
        <td>
          {% if product.discount > 0 %}
            ${{ product.discount }} <br>
            <small class="muted">{{ product.discount_name }}</small>
          {% else %}
            ‚Äî
          {% endif %}
        </td>
        <td>{{ product.featured|yesno:"Yes,No" }}</td>
        <td>{{ product.stock }}</td>
        <td>{{ product.is_bundle|yesno:"Yes,No" }}</td>

        <td class="actions" style="white-space:nowrap;">
          <a href="{% url 'product_edit' product.id %}" class="btn">Edit</a>

          <form action="{% url 'product_delete' product.id %}"
                method="post"
                style="display:inline;">
            {% csrf_token %}
            <button type="submit"
              class="btn accent"
              onclick="return confirm('Delete this product?')">
              Delete
            </button>
          </form>
        </td>
      </tr>

      {% empty %}
      <tr>
        <td colspan="8" style="text-align:center;color:var(--muted);padding:20px;">
          No products found.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</main>

{% endblock %}

{% block scripts %}
<form id="logoutForm" method="post" action="{% url 'logout' %}" style="display:none;">
  {% csrf_token %}
</form>
{% endblock %}
