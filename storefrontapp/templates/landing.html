{% extends "base.html" %}
{% load static %}

{% block title %}
Bean & Bites ‚Äî Coffee & Snacks
{% endblock %}

{% block styles %}
{% endblock %}

{% block topbar %}
<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <img src="https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=7b0e8aa6361fd4d641b2f2d7a1efc0c3" alt="logo" />
      <h1>Bean & Bites</h1>
    </div>

    <div class="search-cart">
      <input id="searchInput" placeholder="Search coffee or snacks..." aria-label="Search" />
      <button id="cartButton" class="cart-btn" aria-label="Open cart">üõí <span id="cartCount">0</span></span></button>

      <!-- User panel -->
      <div class="user-panel">
        {% if request.user.is_authenticated %}
        <div id="userMenu" class="user-menu">
          <button id="userMenuBtn" class="btn menu-btn">‚ò∞</button>
          <div class="menu-dropdown hidden" id="menuDropdown">
            <a href="#" id="profileLink">üë§ {{ request.user.username|default:"My Profile" }}</a>

            {% if request.user.role == "manager" %}
              <a href="{% url 'adminlanding' %}">‚öôÔ∏è Administration</a>
            {% endif %}

            <a href="{% url 'logout' %}" class="logout">üö™ Logout</a>
          </div>
        </div>
        {% else %}
        <button id="loginButton" type="button" class="btn primary">Login</button>
        {% endif %}
      </div>
    </div>
  </div>

  <nav class="category-bar container" id="categories"></nav>
</header>
{% endblock %}

{% block canvas %}
<main class="container main-grid">
  <section class="products-section">
    <div class="controls">
      <div class="sort-group">
        <label for="sortSelect">Sort:</label>
        <select id="sortSelect">
          <option value="default">Featured</option>
          <option value="price-asc">Price: low ‚Üí high</option>
          <option value="price-desc">Price: high ‚Üí low</option>
          <option value="name-asc">Name A ‚Üí Z</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="categoryFilter">Category:</label>
        <select id="categoryFilter" disabled>
          <option value="">All</option>
        </select>
      </div>
    </div>

    <div id="productGrid" class="product-grid"></div>

    <div id="pagination" class="pagination"></div>
  </section>


  <aside class="sidebar about">
    <h3>About</h3>
    <p>Local-roasted coffee, snacks, and small-batch delights. Pick single bags or bundle for savings.</p>

    <h4>Delivery</h4>
    <p>Pickup and local delivery available. Free pickup from our shop.</p>

    <h4>Contact</h4>
    <p>hello@beanandbites.example</p>
  </aside>
</main>

<!-- Cart Sidebar -->
<div id="cartSidebar" class="cart-sidebar">
  <div class="cart-header">
    <h2>Your Cart</h2>
    <button id="closeCart">‚úï</button>
  </div>
  <div id="cartItems" class="cart-items"></div>
  <div class="cart-footer">
    <div class="totals">
      <div><span>Subtotal:</span> <strong id="subtotal">$0.00</strong></div>
      <div><span>Shipping:</span> <strong id="shipping">$0.00</strong></div>
      <div class="total-row"><span>Total:</span> <strong id="total">$0.00</strong></div>
    </div>

    <button id="checkoutBtn" class="btn primary">Checkout</button>
  </div>
</div>
{% endblock %}

{% block modals %}

{% if user.is_authenticated %}
  <div id="checkoutModal" class="modal hidden">
    <div class="modal-content">
      <button class="modal-close" id="closeCheckout">‚úï</button>
      <h2>Checkout</h2>

      <form id="checkoutForm">
        <div class="form-row">
          <label for="name">Full name</label>
          <input id="name" name="name" required value="{{ user.get_full_name }}">
        </div>
        <div class="form-row">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required value="{{ user.email }}">
        </div>
        <div class="form-row">
          <label for="delivery_method">Delivery Method</label>
          <select id="delivery_method" name="delivery_method" class="form-control">
              <option value="pickup">Pickup at Store</option>
              <option value="delivery">Home Delivery</option>
          </select>
        </div>

        <div class="form-row" id="addressRow">
          <label for="address">Address</label>
          <input id="address" name="address" value="{{ user.profile.address|default:'' }}">
        </div>

        <div class="form-row">
          <label for="phone">Phone</label>
          <input id="phone" name="phone" value="{{ user.profile.phone_number|default:'' }}">
        </div>

        <div class="form-row">
          <label for="note">Note (optional)</label>
          <input id="note" name="note" placeholder="Any instructions or notes...">
        </div>

        <div class="order-summary" id="orderSummary"></div>

        <button type="submit" class="btn primary">Place order (simulate)</button>
      </form>
    </div>
  </div>

{% else %}

  <div id="checkoutModal" class="modal hidden">
    <div class="modal-content" style="text-align:center;">
      <button class="modal-close" id="closeCheckout">‚úï</button>
      <h2>Checkout</h2>

      <form id="checkoutForm">
        <div id="orderSummary"></div>
        <p style="margin-top:12px;">‚ö†Ô∏è You need to be logged in to place an online order.</p>
        <p>Don‚Äôt have an account?<br>
          <a href="{% url 'newcontact' %}" class="btn">Request one here</a>
        </p>
      </form>
    </div>
  </div>

{% endif %}

<!-- Quick View -->
<div id="productModal" class="modal hidden">
  <div class="modal-content">
    <button class="modal-close" id="closeProductModal">‚úï</button>
    <div id="productModalBody"></div>
  </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal hidden">
  <div class="modal-content">
    <button class="modal-close" id="closeLogin">‚úï</button>
    <h2>Login</h2>

    <form id="loginForm" method="post" action="{% url 'login' %}">
      {% csrf_token %}
      <div class="form-row">
        <label for="username">Username</label>
        <input id="username" name="username" required placeholder="Username" />
      </div>
      <div class="form-row">
        <label for="password">Password</label>
        <input id="password" name="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button type="submit" class="btn primary" style="width:100%;margin-top:10px;">Login</button>
      <p style="text-align:center;margin-top:10px;font-size:.9rem;color:var(--muted)">
        Don‚Äôt have an account? <a href="{% url 'newcontact' %}">Sign up</a>
      </p>
    </form>
  </div>
</div>

<!-- Order Success Modal -->
<div id="orderSuccessModal" class="modal hidden">
  <div class="modal-content" style="max-width:420px;text-align:center;">
    <button class="modal-close" id="closeOrderSuccess">‚úï</button>

    <div style="font-size:3rem; margin-bottom:10px;">üéâ</div>
    <h2>Order Placed!</h2>

    <p id="orderSuccessMessage" style="margin-top:10px; color:var(--muted);">
      Your order has been placed successfully.
    </p>

    <div style="margin-top:20px;">
      <button id="orderSuccessOk" class="btn primary" style="width:100%;">
        Continue Shopping
      </button>
    </div>
  </div>
</div>


{% endblock %}

{% block scripts %}
<script src="{% static 'js/landing.js' %}"></script>

<form id="logoutForm" action="{% url 'logout' %}" method="post" style="display:none;">
  {% csrf_token %}
</form>
{% endblock %}
